generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model School {
  id                String          @id @default(cuid())
  schoolStudentCode Int             @unique
  schoolAdminCode   Int             @unique
  name              String
  createdAt         DateTime        @default(now())
  backgroundInfo    String?
  rigorLevels       String[]        @default([])
  admins            Administrator[]
  clubs             Club[]
  courses           Course[]
  programs          Program[]
  sports            Sport[]
  students          Student[]
}

model User {
  id            String         @id @default(cuid())
  email         String         @unique
  createdAt     DateTime       @default(now())
  firstName     String
  gender        String
  lastName      String
  middleName    String?
  passwordHash  String
  preferredName String?
  role          UserRole
  admin         Administrator?
  sessions      Session[]
  student       Student?
}

model Session {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  expiresAt DateTime
  userId    String
  user      User     @relation(fields: [userId], references: [id])
}

model Administrator {
  userId   String  @id
  schoolId String?
  school   School? @relation(fields: [schoolId], references: [id])
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Student {
  gradeLevel           Int
  graduationYear       Int
  bio                  String?
  userId               String               @id
  schoolId             String?
  careerInterest       String?
  interestedInNCAA     Boolean              @default(false)
  postHighSchoolPlan   String?
  interests            String[]
  studyHallsPerYear    Int?                 @default(0)
  subjectInterests     String[]
  maxStudyHallsPerYear Int?                 @default(0)
  age                  Int?
  collegePlanSummary   String?
  desiredCourseRigor   String?
  ClubRecommendation   ClubRecommendation[]
  school               School?              @relation(fields: [schoolId], references: [id])
  user                 User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  studentCourses       StudentCourse[]
  clubs                Club[]               @relation("ClubToStudent")
  targetColleges       College[]            @relation("CollegeToStudent")
  focusPrograms        Program[]            @relation("ProgramToStudent")
  sports               Sport[]              @relation("SportToStudent")
  savedOpportunities   Opportunity[]        @relation("OpportunityToStudent")
}

model Program {
  id          String    @id @default(cuid())
  name        String
  description String?
  schoolId    String
  school      School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  students    Student[] @relation("ProgramToStudent")

  @@unique([name, schoolId])
}

model College {
  id           String    @id @default(cuid())
  name         String    @unique
  requirements String[]
  suggestions  String[]
  type         String
  students     Student[] @relation("CollegeToStudent")
}

model Club {
  id                 String               @id @default(cuid())
  name               String
  category           String
  description        String?
  schoolId           String
  studentLeaders     String?
  teacherLeader      String?
  school             School               @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  ClubRecommendation ClubRecommendation[]
  students           Student[]            @relation("ClubToStudent")

  @@unique([name, schoolId])
}

model Sport {
  id       String    @id @default(cuid())
  name     String
  season   String
  gender   String
  schoolId String
  school   School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  students Student[] @relation("SportToStudent")

  @@unique([name, schoolId])
}

model Course {
  id              String          @id @default(cuid())
  name            String
  department      String
  code            String?
  schoolId        String
  availableGrades Int[]
  bundleId        String?
  countsForGrad   Boolean         @default(true)
  credits         Float?
  level           String?
  prerequisites   String?
  programTag      String?
  requirements    String[]
  school          School          @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  students        StudentCourse[]

  @@unique([name, schoolId])
}

model StudentCourse {
  id              String       @id @default(cuid())
  studentId       String
  courseId        String
  grade           String?
  status          CourseStatus @default(IN_PROGRESS)
  confidenceLevel String?
  stressLevel     String?
  gradeLevel      Int?
  course          Course       @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student         Student      @relation(fields: [studentId], references: [userId], onDelete: Cascade)

  @@unique([studentId, courseId])
}

model ClubRecommendation {
  id        String   @id
  createdAt DateTime @default(now())
  reason    String
  timing    String
  studentId String
  clubId    String
  Club      Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  Student   Student  @relation(fields: [studentId], references: [userId], onDelete: Cascade)

  @@unique([studentId, clubId])
}

model Opportunity {
  id              String    @id @default(cuid())
  originalId      String?   @unique
  title           String
  organization    String
  locationJson    String
  within45Min     Boolean
  type            String
  paid            Boolean
  paidDescription String?
  timeOfYear      String
  timeCommitment  String
  eligibility     String
  deadline        String
  description     String
  link            String
  students        Student[] @relation("OpportunityToStudent")
}

enum UserRole {
  STUDENT
  ADMIN
}

enum CourseStatus {
  COMPLETED
  IN_PROGRESS
  NEXT_SEMESTER
  PLANNED
}

enum ConfidenceLevel {
  VERY_LOW
  LOW
  NEUTRAL
  HIGH
  VERY_HIGH
}
